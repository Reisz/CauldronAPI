CList = class("CList")
local _private = setmetatable({}, {__mode = "k"})

function CList:initialize(...)
    _private[self] = {...}
end

function CList:copy(other)
    return CList(unpack(_private[self]))
end

function CList:toTable()
    return _private[self]
end

function CList:insert(pos, value)
    if value == nil then
        value = pos
        pos = #_private[self] + 1
    end
    return table.insert(_private[self], pos, value)
end

function CList:at(pos)
    return _private[self][pos]
end

function CList:maxn()
    return table.maxn(_private[self])
end

function CList:length()
    return #_private[self]
end

function CList:find(value)
    for i,v in ipairs(_private[self]) do
        if v == value then return i end
    end
    return nil
end

function CList:findAll(value)
    local result = {}
    for i, v in ipairs(_private[self]) do
        if v == value then table.insert(result, i) end
    end
    return unpack(result)
end

function CList:remove(pos)
    pos = pos or #_private[self]
    return table.remove(_private[self], pos)
end

function CList:removeAll(...)
    local input, result, offset = {...}, {}, 0
    table.sort(input)
    for _, v in ipairs(input) do 
        table.insert(result, self:remove(v - offset))
        offset = offset + 1
    end
    return unpack(result)
end

function CList:sort(comp)
    table.sort(_private[self], comp)
end

function CList:dump()
    for i, v in ipairs(_private[self]) do print("[", i, "] = ", v) end
end

function CList:unpack()
    return unpack(_private[self])
end
