-- Load file generated by installer
Cauldron = setmetatable({}, {
    __tostring = function()
        return "Cauldron " .. Cauldron.versionString()
    end
})

-- Dynamic stuff
function Cauldron.version() return %i end
function Cauldron.versionString() return %q end
function Cauldron.libDirectory(sub) return %q .. sub end
               
-- Loading helpers
local function _load(name)
    shell.run(Cauldron.libDirectory(name))
end

local function _scan(dir)
    dir = dir .. "/"
    local files = fs.list(dir)
    for _, v in ipairs(files) do
        if fs.isDir(dir .. v) then
            _scan(dir .. v)
        else
            shell.run(dir .. v)
        end
    end
end

Cauldron._loaded = {}

-- Actual load function
function Cauldron.loadModule(name)
    if Cauldron._loaded[name] then return end
    _scan(Cauldron.libDirectory("") .. name)
    Cauldron._loaded[name] = true
end

-- API is useless without them
_load("middleclass")
Cauldron.loadModule("CCore")
